{
    "app-id": "org.gajim.Gajim",
    "runtime": "org.gnome.Platform",
    "runtime-version": "3.28",
    "sdk": "org.gnome.Sdk",
    "command": "gajim",
    "tags": ["nightly"],
    "desktop-file-name-prefix": "(Nightly) ",
    "finish-args": [
        "--share=ipc",
        "--share=network",
        "--socket=x11",
        "--socket=wayland",
        "--socket=pulseaudio",
        "--system-talk-name=org.freedesktop.GeoClue2",
        "--system-talk-name=org.freedesktop.login1",
        "--talk-name=org.gnome.ScreenSaver",
        "--talk-name=org.mpris.MediaPlayer2.*",
        /* Keyring */
        "--talk-name=org.freedesktop.secrets",
        /* dconf */
        "--filesystem=xdg-run/dconf",
        "--filesystem=~/.config/dconf:ro",
        "--talk-name=ca.desrt.dconf",
        "--env=DCONF_USER_CONFIG_DIR=.config/dconf",
        /* extensions */
        "--env=PYTHONPATH=/app/plugins/lib/python3.5/site-packages"
    ],
    "add-extensions": {
        "org.gajim.Gajim.Plugin": {
            "directory": "plugins",
            "merge-dirs": "lib/python3.5/site-packages",
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": true
        }
    },
    "build-options": {
        "cflags": "-O2 -g",
        "cxxflags": "-O2 -g"
    },
    "cleanup": [
        "/bin/easy*",
        "/include",
        "/lib/debug",
        "/lib/pkgconfig",
        "/lib/python2.7",
        "/share/aclocal",
        "/share/doc",
        "/share/man",
        "*.a",
        "*.la"
    ],
    "modules": [
        {
            "name": "python3-pycparser",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://pypi.python.org/packages/8c/2d/aad7f16146f4197a11f8e91fb81df177adcc2073d36a17b1491fd09df6ed/pycparser-2.18.tar.gz",
                    "sha256": "99a8ca03e29851d96616ad0404b4aad7d9ee16f25c9f9708a11faf2810f7b226"
                }
            ]
        },
        {
            "name": "python3-cffi",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/e7/a7/4cd50e57cc6f436f1cc3a7e8fa700ff9b8b4d471620629074913e3735fb2/cffi-1.11.5.tar.gz",
                    "sha256": "e90f17980e6ab0f3c2f3730e56d1fe9bcba1891eeea58966e89d352492cc74f4"
                }
            ]
        },
        {
            "name": "python3-six",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app six-1.11.0-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://pypi.python.org/packages/67/4b/141a581104b1f6397bfa78ac9d43d8ad29a7ca43ea90a2d863fe3056e86a/six-1.11.0-py2.py3-none-any.whl",
                    "sha256": "832dc0e10feb1aa2c68dcc57dbb658f1c7e65b9b61af69048abc87a2db00a0eb"
                }
            ]
        },
        {
            "name": "python3-pyparsing",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app pyparsing-2.2.0-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://pypi.python.org/packages/6a/8a/718fd7d3458f9fab8e67186b00abdd345b639976bc7fb3ae722e1b026a50/pyparsing-2.2.0-py2.py3-none-any.whl",
                    "sha256": "fee43f17a9c4087e7ed1605bd6df994c6173c1e977d7ade7b651292fab2bd010"
                }
            ]
        },
        {
            "name": "python3-packaging",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app packaging-17.1-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/ad/c2/b500ea05d5f9f361a562f089fc91f77ed3b4783e13a08a3daf82069b1224/packaging-17.1-py2.py3-none-any.whl",
                    "sha256": "e9215d2d2535d3ae866c3d6efc77d5b24a0192cce0ff20e42896cc0664f889c0"
                }
            ]
        },
        {
            "name": "python3-appdirs",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app appdirs-1.4.3-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://pypi.python.org/packages/56/eb/810e700ed1349edde4cbdc1b2a21e28cdf115f9faf263f6bbf8447c1abf3/appdirs-1.4.3-py2.py3-none-any.whl",
                    "sha256": "d8b24664561d0d34ddfaec54636d502d7cea6e29c3eaf68f3df6180863e2166e"
                }
            ]
        },
        {
            "name": "python3-setuptools",
            "ensure-writable": [
                "easy-install.pth",
                "setuptools.pth"
            ],
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/1a/04/d6f1159feaccdfc508517dba1929eb93a2854de729fa68da9d5c6b48fa00/setuptools-39.2.0.zip",
                    "sha256": "f7cddbb5f5c640311eb00eab6e849f7701fa70bf6a183fc8a2c33dd1d1672fb2"
                }
            ]
        },
        {
            "name": "python3-asn1crypto",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app asn1crypto-0.24.0-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://pypi.python.org/packages/ea/cd/35485615f45f30a510576f1a56d1e0a7ad7bd8ab5ed7cdc600ef7cd06222/asn1crypto-0.24.0-py2.py3-none-any.whl",
                    "sha256": "2f1adbb7546ed199e3c90ef23ec95c5cf3585bac7d11fb7eb562a3fe89c64e87"
                }
            ]
        },
        {
            "name": "python3-idna",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app idna-2.6-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://pypi.python.org/packages/27/cc/6dd9a3869f15c2edfab863b992838277279ce92663d334df9ecf5106f5c6/idna-2.6-py2.py3-none-any.whl",
                    "sha256": "8c7309c718f94b3a625cb648ace320157ad16ff131ae0af362c9f21b80ef6ec4"
                }
            ]
        },
        {
            "name": "python3-cryptography",
            "ensure-writable": [
                "easy-install.pth"
            ],
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/ec/b2/faa78c1ab928d2b2c634c8b41ff1181f0abdd9adf9193211bd606ffa57e2/cryptography-2.2.2.tar.gz",
                    "sha256": "9fc295bf69130a342e7a19a39d7bbeb15c0bcaabc7382ec33ef3b2b7d18d2f63"
                }
            ]
        },
        {
            "name": "python3-pyopenssl",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app pyOpenSSL-18.0.0-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/96/af/9d29e6bd40823061aea2e0574ccb2fcf72bfd6130ce53d32773ec375458c/pyOpenSSL-18.0.0-py2.py3-none-any.whl",
                    "sha256": "26ff56a6b5ecaf3a2a59f132681e2a80afcc76b4f902f612f518f92c2a1bf854"
                }
            ]
        },
        {
            "name": "python3-dbus-python",
            "build-options": {
                "env": {
                    "PYTHON_VERSION": "3"
                }
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/3f/e7/4edb582d1ffd5ac3c84188deea32e960b5c8c0fe1da56ce70224f85ce542/dbus-python-1.2.8.tar.gz",
                    "sha256": "abf12bbb765e300bf8e2a1b2f32f85949eab06998dbda127952c31cb63957b6f"
                }
            ]
        },
        /* gnupg support */
        {
            "name": "python3-python-gnupg",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app python_gnupg-0.4.2-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/ba/27/b87814299af38edc6905042c07a7f889d15914b0589b9cd197b9efb09cea/python_gnupg-0.4.2-py2.py3-none-any.whl",
                    "sha256": "38f18712b7cfdd0d769bc88a21e90138154b9be2cbffb1e7d28bc37ee73a1c47"
                }
            ]
        },
        /* OMEMO support */
        {
            "name": "protobuf",
            "ensure-writable": [
                "easy-install.pth",
                "setuptools.pth"
            ],
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/14/03/ff5279abda7b46e9538bfb1411d42831b7e65c460d73831ed2445649bc02/protobuf-3.5.1.tar.gz",
                    "sha256": "95b78959572de7d7fafa3acb718ed71f482932ddddddbd29ba8319c10639d863"
                }
            ]
        },
        {
            "name": "python3-axolotl-curve25519",
            "ensure-writable": [
                "easy-install.pth"
            ],
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/59/ca/c8111718bcc8da18e9b9868e784293232a58c57159a5ea18f00ee967258f/python-axolotl-curve25519-0.4.1.post2.tar.gz",
                    "sha256": "0705a66297ebd2f508a60dc94e22881c754301eb81db93963322f6b3bdcb63a3"
                }
            ]
        },
        {
            "name": "python3-axolotl",
            "ensure-writable": [
                "easy-install.pth",
                "setuptools.pth"
            ],
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/27/99/3b905f0061aba53526408d286e53cee3b00c9fd256eed7d21d5d41033690/python-axolotl-0.1.42.tar.gz",
                    "sha256": "ef78c2efabcd4c33741669334bdda04710a3ef0e00b653f00127acff6460a7f0"
                }
            ]
        },
        {
            "name": "python3-jeepny",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app jeepney-0.3.1-py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/a9/21/c07060fac57d8d4932ccb19f96b244ff056f13192993d2d1253fb87d6784/jeepney-0.3.1-py3-none-any.whl",
                    "sha256": "e7b961fe9dfa1ed4c576d3bb2d70a9276dace0e16ebed9da09e4d288fe1d3b2a"
                }
            ]
        },
        {
            "name": "python3-secretstorage",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app SecretStorage-3.0.1-py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/f3/40/3cbd8b15c8f98b5c6d2480fb0087b06eb39b87992e61c966775156e1a693/SecretStorage-3.0.1-py3-none-any.whl",
                    "sha256": "1bbf5b85a718854916d1c151fa33e6f667e3c005e033ea46d4123384d233b137"
                }
            ]
        },
        {
            "name": "python3-entrypoints",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app entrypoints-0.2.3-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/cc/8b/4eefa9b47f1910b3d2081da67726b066e379b04ca897acfe9f92bac56147/entrypoints-0.2.3-py2.py3-none-any.whl",
                    "sha256": "10ad569bb245e7e2ba425285b9fa3e8178a0dc92fc53b1e1c553805e15a8825b"
                }
            ]
        },
        {
            "name": "python3-keyring",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app keyring-12.2.1-py2.py3-none-any.whl"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://files.pythonhosted.org/packages/47/c0/4dfeeedaa233a12c3e5eb1e079b4dce96bbcbf0d030abc5e9a6b771e5812/keyring-12.2.1-py2.py3-none-any.whl",
                    "sha256": "fd597e72df7240ec5a4215c50957e41c3d4bd321d97bf163f4a8e75ca287d77b"
                }
            ]
        },
        {
            "name": "python3-nbxmpp",
            "buildsystem": "simple",
            "build-commands": [
                "python3 setup.py install --prefix=/app"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://dev.gajim.org/gajim/python-nbxmpp.git",
                    "tag": "nbxmpp-0.6.6",
                    "commit": "7256d13ebcde065824da4715df0db399fe9aaf57"
                }
            ]
        },
        {
            "name": "gajim",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --prefix=/app .",
                "touch /app/share/run-as-flatpak"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://dev.gajim.org/gajim/gajim.git"
                }
            ],
            "post-install": [
                "install -d /app/plugins"
            ]
        }
    ]
}
